# üîç –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã –ø–æ–∏—Å–∫–∞ –≥—Ä—É–ø–ø

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

1. **–ü–æ–∏—Å–∫ –≥—Ä—É–ø–ø –ø–æ username** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –Ω–∞–π—Ç–∏ –ø—É–±–ª–∏—á–Ω—ã–µ –≥—Ä—É–ø–ø—ã
2. **–ü–æ–¥–∞—á–∞ –∑–∞—è–≤–æ–∫** - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫** - –∞–¥–º–∏–Ω—ã/—Å–æ–∑–¥–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω—è—Ç—å –∑–∞—è–≤–∫–∏

---

## üöÄ –®–∞–≥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
cd server
node apply-chat-username-migration.js
```

–≠—Ç–æ –¥–æ–±–∞–≤–∏—Ç –ø–æ–ª—è `username` –∏ `isPrivate` –∫ —Ç–∞–±–ª–∏—Ü–µ —á–∞—Ç–æ–≤.

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π —Å–µ—Ä–≤–µ—Ä (Ctrl+C)
npm run dev
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å username –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≥—Ä—É–ø–ø

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≥—Ä—É–ø–ø—ã –ø–æ–ª—É—á–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ username –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
```
–Ω–∞–∑–≤–∞–Ω–∏–µ_–≥—Ä—É–ø–ø—ã_12345678
```

–ì–¥–µ `12345678` - –ø–µ—Ä–≤—ã–µ 8 —Å–∏–º–≤–æ–ª–æ–≤ ID —á–∞—Ç–∞.

---

## üìù –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

### –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

1. **–ù–∞–π—Ç–∏ –≥—Ä—É–ø–ø—É:**
   - –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ù–∞–π—Ç–∏ –≥—Ä—É–ø–ø—É" –≤ —Å–ø–∏—Å–∫–µ —á–∞—Ç–æ–≤
   - –í–≤–µ–¥–∏—Ç–µ username –≥—Ä—É–ø–ø—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: `–æ–±—â–∏–π_—á–∞—Ç_a1b2c3d4`)
   - –ù–∞–∂–º–∏—Ç–µ "–ù–∞–π—Ç–∏"

2. **–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É:**
   - –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ–∏—Å–∫–∞ –Ω–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É"
   - –ó–∞—è–≤–∫–∞ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–æ–∑–¥–∞—Ç–µ–ª—é –≥—Ä—É–ø–ø—ã

### –î–ª—è –∞–¥–º–∏–Ω–æ–≤/—Å–æ–∑–¥–∞—Ç–µ–ª–µ–π –≥—Ä—É–ø–ø:

1. **–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫:**
   - –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ –∑–∞—è–≤–∫–∏, –ø–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–ó–∞—è–≤–∫–∏ (N)" –≤ —Å–ø–∏—Å–∫–µ —á–∞—Ç–æ–≤
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ—ë –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫:**
   - –ù–∞–∂–º–∏—Ç–µ "‚úì –ü—Ä–∏–Ω—è—Ç—å" —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É
   - –ù–∞–∂–º–∏—Ç–µ "‚úó –û—Ç–∫–ª–æ–Ω–∏—Ç—å" —á—Ç–æ–±—ã –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ username –¥–ª—è –≥—Ä—É–ø–ø—ã:

### –ß–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–∞ (–±—É–¥—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è):

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —á–∞—Ç–∞ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π username:
- –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–∞
- –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª–µ "Username –≥—Ä—É–ø–ø—ã"
- –í–≤–µ–¥–∏—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π username (—Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω–∏—Ü–∞, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ)
- –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

### –ß–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–≤—Ä–µ–º–µ–Ω–Ω–æ):

```sql
UPDATE chats 
SET username = 'my_custom_username' 
WHERE id = 'chat_id_here';
```

---

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–π –≥—Ä—É–ø–ø—ã:

```javascript
// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≥—Ä—É–ø–ø—ã —á–µ—Ä–µ–∑ API
POST /api/chats
{
  "name": "–û–±—â–∏–π —á–∞—Ç",
  "type": "GROUP",
  "isPrivate": false  // –ü—É–±–ª–∏—á–Ω–∞—è –≥—Ä—É–ø–ø–∞
}
```

### –ü–æ–∏—Å–∫ –≥—Ä—É–ø–ø—ã:

```javascript
// –ü–æ–∏—Å–∫ –ø–æ username
GET /api/chats/search?username=–æ–±—â–∏–π_—á–∞—Ç
```

### –ü–æ–¥–∞—á–∞ –∑–∞—è–≤–∫–∏:

```javascript
// –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ
POST /api/chat-invites/request
{
  "chatId": "group_id_here"
}
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:

### –¢–∞–±–ª–∏—Ü–∞ chats:
```sql
- id: TEXT PRIMARY KEY
- name: TEXT
- type: TEXT (GROUP/DIRECT)
- username: TEXT UNIQUE  -- –ù–æ–≤–æ–µ –ø–æ–ª–µ
- isPrivate: INTEGER     -- –ù–æ–≤–æ–µ –ø–æ–ª–µ (0 = –ø—É–±–ª–∏—á–Ω–∞—è, 1 = –ø—Ä–∏–≤–∞—Ç–Ω–∞—è)
- ownerId: TEXT
- createdAt: TEXT
```

### –¢–∞–±–ª–∏—Ü–∞ chat_invites:
```sql
- id: TEXT PRIMARY KEY
- chatId: TEXT
- fromUserId: TEXT  -- –ö—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–∞—è–≤–∫—É
- toUserId: TEXT    -- –ö–æ–º—É (–≤–ª–∞–¥–µ–ª–µ—Ü –≥—Ä—É–ø–ø—ã)
- status: TEXT      -- PENDING/ACCEPTED/REJECTED
- createdAt: TEXT
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

1. **–¢–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–µ –≥—Ä—É–ø–ø—ã** –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ (`isPrivate = 0`)
2. **–¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü/–∞–¥–º–∏–Ω** –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞—è–≤–∫–∏
3. **–ù–µ–ª—å–∑—è –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É** –µ—Å–ª–∏ —É–∂–µ —è–≤–ª—è–µ—à—å—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–º
4. **–ù–µ–ª—å–∑—è –ø–æ–¥–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∑–∞—è–≤–∫—É** –ø–æ–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∞—è –≤ —Å—Ç–∞—Ç—É—Å–µ PENDING

---

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### –û—à–∏–±–∫–∞ "username already exists":
- Username –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
- –ò–∑–º–µ–Ω–∏—Ç–µ username –≥—Ä—É–ø–ø—ã –Ω–∞ –¥—Ä—É–≥–æ–π

### –ì—Ä—É–ø–ø–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≥—Ä—É–ø–ø–∞ –ø—É–±–ª–∏—á–Ω–∞—è (`isPrivate = 0`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è username
- Username —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É

### –ó–∞—è–≤–∫–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—ã –Ω–µ —è–≤–ª—è–µ—Ç–µ—Å—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –≥—Ä—É–ø–ø—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞—è–≤–∫–∏ (PENDING)

---

## ‚ú® –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ username –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≥—Ä—É–ø–ø—ã:

–û–±–Ω–æ–≤–∏—Ç–µ `CreateChatModal.tsx`:

```typescript
const [username, setUsername] = useState('');

// –í —Ñ–æ—Ä–º–µ –¥–æ–±–∞–≤—å—Ç–µ:
<input
  type="text"
  value={username}
  onChange={(e) => setUsername(e.target.value)}
  placeholder="Username –≥—Ä—É–ø–ø—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
/>

// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏:
onCreateChat(chatName, chatType, username);
```

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ username –≤ —Å–ø–∏—Å–∫–µ —á–∞—Ç–æ–≤:

```typescript
<p className="text-xs text-gray-400">@{chat.username}</p>
```

---

## üì± –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. –°–æ–∑–¥–∞–π—Ç–µ –≥—Ä—É–ø–ø—É —á–µ—Ä–µ–∑ "–°–æ–∑–¥–∞—Ç—å —á–∞—Ç"
2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è username
3. –í–æ–π–¥–∏—Ç–µ –ø–æ–¥ –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
4. –ù–∞–π–¥–∏—Ç–µ –≥—Ä—É–ø–ø—É —á–µ—Ä–µ–∑ "–ù–∞–π—Ç–∏ –≥—Ä—É–ø–ø—É"
5. –ü–æ–¥–∞–π—Ç–µ –∑–∞—è–≤–∫—É
6. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ –ø–µ—Ä–≤–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
7. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–Ω–æ–ø–∫—É "–ó–∞—è–≤–∫–∏"
8. –ü—Ä–∏–º–∏—Ç–µ –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç–µ –∑–∞—è–≤–∫—É

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:
- ‚úÖ –ü–æ–∏—Å–∫ –ø—É–±–ª–∏—á–Ω—ã—Ö –≥—Ä—É–ø–ø –ø–æ username
- ‚úÖ –ü–æ–¥–∞—á–∞ –∑–∞—è–≤–æ–∫ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫ –∞–¥–º–∏–Ω–∞–º–∏
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞—è–≤–∫–∞—Ö

**–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π!**
