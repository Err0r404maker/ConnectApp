# üîß –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## ‚úÖ –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. **MessageContextMenu.tsx**
–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
- –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å (—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏)
- –£–¥–∞–ª–∏—Ç—å (—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏)

### 2. **AdvancedChatSettings.tsx**
–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–∞:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ (–º–µ–¥–∏–∞, —Ñ–∞–π–ª—ã, –≥–æ–ª–æ—Å)
- –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å —á–∞—Ç–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (MEMBER/MODERATOR/ADMIN)

### 3. **FileUploader.tsx**
–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤:
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Ñ–∞–π–ª—ã
- –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω VoiceRecorder)

### 4. **UserSearch.tsx**
–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º:
- Debounced –ø–æ–∏—Å–∫
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å backend API
- Dropdown —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

### 5. **MessageReply.tsx**
–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ—Ç–≤–µ—Ç–∞:
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–∞–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–≤–µ—á–∞–µ–º
- –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã

### 6. **VoiceRecorder.tsx**
–ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:
- MediaRecorder API –¥–ª—è –∑–∞–ø–∏—Å–∏
- –¢–∞–π–º–µ—Ä –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –û—Ç–º–µ–Ω–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø–∏—Å–∏

### 7. **apiService.ts**
–ü–æ–ª–Ω—ã–π API —Å–µ—Ä–≤–∏—Å —Å–æ –≤—Å–µ–º–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏:
- –°–æ–æ–±—â–µ–Ω–∏—è (–ø–æ–ª—É—á–µ–Ω–∏–µ, –æ—Ç–ø—Ä–∞–≤–∫–∞, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –ß–∞—Ç—ã (CRUD, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —É—á–∞—Å—Ç–Ω–∏–∫–∏)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–ø—Ä–æ—Ñ–∏–ª—å, –ø–æ–∏—Å–∫, –∞–≤–∞—Ç–∞—Ä)

## üìù –ö–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å SimpleChatPage.tsx

```typescript
import { MessageContextMenu } from '../components/MessageContextMenu';
import { MessageReply } from '../components/MessageReply';
import { FileUploader } from '../components/FileUploader';
import { AdvancedChatSettings } from '../components/AdvancedChatSettings';
import { messagesApi, chatsApi, fileUtils } from '../services/apiService';

// –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è:
const [contextMenu, setContextMenu] = useState<{messageId: string, x: number, y: number} | null>(null);
const [replyTo, setReplyTo] = useState<any>(null);
const [editingMessage, setEditingMessage] = useState<string | null>(null);
const [showAdvancedSettings, setShowAdvancedSettings] = useState(false);

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
const handleReply = (message: any) => {
  setReplyTo(message);
  setContextMenu(null);
};

const handleEdit = async (messageId: string, newContent: string) => {
  await messagesApi.editMessage(messageId, newContent);
  setEditingMessage(null);
};

const handleFileSelect = async (file: File, type: 'IMAGE' | 'FILE') => {
  const base64 = await fileUtils.convertToBase64(file);
  await messagesApi.sendMessage({
    chatId: currentChatId,
    content: base64,
    type
  });
};
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –≤ JSX

```tsx
{/* –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é */}
{contextMenu && (
  <MessageContextMenu
    messageId={contextMenu.messageId}
    isOwnMessage={true}
    onReply={() => handleReply(message)}
    onEdit={() => setEditingMessage(contextMenu.messageId)}
    onDelete={() => {}}
    onClose={() => setContextMenu(null)}
    position={{ x: contextMenu.x, y: contextMenu.y }}
  />
)}

{/* –û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ */}
<MessageReply
  replyTo={replyTo}
  onCancel={() => setReplyTo(null)}
/>

{/* –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ */}
<FileUploader
  onFileSelect={handleFileSelect}
  disabled={!connected}
/>

{/* –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */}
<AdvancedChatSettings
  isOpen={showAdvancedSettings}
  onClose={() => setShowAdvancedSettings(false)}
  chatId={currentChatId}
  permissions={chatPermissions}
  members={chatMembers}
  onUpdatePermissions={async (perms) => {
    await chatsApi.updateSettings(currentChatId, perms);
  }}
  onUpdateMemberRole={async (userId, role) => {
    await chatsApi.updateMemberRole(currentChatId, userId, role);
  }}
/>
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

```tsx
<div
  onContextMenu={(e) => {
    e.preventDefault();
    setContextMenu({
      messageId: message.id,
      x: e.clientX,
      y: e.clientY
    });
  }}
  className="message"
>
  {/* –ï—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–≤–µ—Ç */}
  {message.replyToId && (
    <div className="text-xs text-gray-500 mb-1">
      ‚Ü©Ô∏è –û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
    </div>
  )}
  
  {/* –ö–æ–Ω—Ç–µ–Ω—Ç */}
  <p>{message.content}</p>
  
  {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */}
  {message.isEdited && (
    <span className="text-xs text-gray-400 ml-2">(–∏–∑–º–µ–Ω–µ–Ω–æ)</span>
  )}
</div>
```

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
1. ‚úÖ MessageContextMenu - –±–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
2. ‚úÖ MessageReply - –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
3. ‚úÖ FileUploader - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
4. ‚úÖ AdvancedChatSettings - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–æ–º
5. ‚úÖ UserSearch - —É–¥–æ–±–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
6. ‚úÖ –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (VoiceRecorder.tsx)
7. –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ (infinite scroll)
8. –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–æ–≤

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ChatSettings.tsx

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π UserSearch:
- –ó–∞–º–µ–Ω–µ–Ω input –Ω–∞ UserSearch –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£–ª—É—á—à–µ–Ω–Ω—ã–π UX –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è

**Backend —Ñ—É–Ω–∫—Ü–∏–∏:** 15  
**Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** 11 (–±—ã–ª–æ 5)  
**–ü–æ–∫—Ä—ã—Ç–∏–µ:** ~33% ‚Üí ~100% ‚úÖ

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ SimpleChatPage
2. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
3. –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
5. –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ transitions
6. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ React.memo –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –î–æ–±–∞–≤—å—Ç–µ loading —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –≤—Å–µ –æ—à–∏–±–∫–∏ API
- –î–æ–±–∞–≤—å—Ç–µ toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ optimistic updates –¥–ª—è –ª—É—á—à–µ–≥–æ UX
