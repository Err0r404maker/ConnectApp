# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –û—à–∏–±–∫–∞ 500 –Ω–∞ `/api/chats/:chatId/members`
**–ü—Ä–æ–±–ª–µ–º–∞:** JOIN —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
**–†–µ—à–µ–Ω–∏–µ:** 
- –ò–∑–º–µ–Ω–µ–Ω `JOIN` –Ω–∞ `LEFT JOIN`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è `validMembers.filter(m => m.username)`

### 2. –û—à–∏–±–∫–∞ 500 –Ω–∞ `/api/friends`
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π SQL –∑–∞–ø—Ä–æ—Å —Å JOIN
**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∑–∞–ø—Ä–æ—Å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `CASE WHEN`
- –î–æ–±–∞–≤–ª–µ–Ω `LEFT JOIN` –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### 3. –û—à–∏–±–∫–∞ 404 –Ω–∞ `/api/users/:userId`
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –ë–î
**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `cleanup-db.js`
- –£–¥–∞–ª–µ–Ω–æ 5 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –£–¥–∞–ª–µ–Ω–æ 17 —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 4. –û—à–∏–±–∫–∞ 401 (Unauthorized)
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å—Ç–µ–∫—à–∏–π —Ç–æ–∫–µ–Ω
**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `fetchWithAuth.ts` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
- –î–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh –ø—Ä–∏ 401

### 5. WebSocket –æ—à–∏–±–∫–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
**–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ –∫–æ–¥–µ, –æ—à–∏–±–∫–∏ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã

## üìù –ó–∞–ø—É—Å–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –®–∞–≥ 1: –û—á–∏—Å—Ç–∫–∞ –ë–î
```bash
node cleanup-db.js
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –£–¥–∞–ª–µ–Ω–æ 5 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚úÖ –£–¥–∞–ª–µ–Ω–æ 17 —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 16 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, 18 —á–∞—Ç–æ–≤, 32 —É—á–∞—Å—Ç–Ω–∏–∫–∞

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
cd server
npm run dev
```

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞
```bash
cd client
npm run dev
```

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ fetchWithAuth (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤–æ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö:

```typescript
import { fetchWithAuth } from '../utils/fetchWithAuth';

// –í–º–µ—Å—Ç–æ:
const response = await fetch(url, {
  headers: { Authorization: `Bearer ${accessToken}` }
});

// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
const response = await fetchWithAuth(url, {
  method: 'GET'
});
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—à–∏–±–æ–∫:** 5
- ‚úÖ 500 –Ω–∞ members
- ‚úÖ 500 –Ω–∞ friends  
- ‚úÖ 404 –Ω–∞ users
- ‚úÖ 401 unauthorized
- ‚úÖ WebSocket warnings

**–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 2
- `cleanup-db.js` - —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏
- `fetchWithAuth.ts` - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤

**–û–±–Ω–æ–≤–ª–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 2
- `chats-simple.js` - LEFT JOIN
- `friends.js` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω SQL

## üöÄ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –í—Å–µ API —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ë–î –æ—á–∏—â–µ–Ω–∞ –æ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –¢–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–†–µ–≥—É–ª—è—Ä–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ë–î:**
   ```bash
   node cleanup-db.js
   ```

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤:**
   - –°–µ—Ä–≤–µ—Ä: –∫–æ–Ω—Å–æ–ª—å —Å `npm run dev`
   - –ö–ª–∏–µ–Ω—Ç: DevTools Console

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤:**
   - Access token: 15 –º–∏–Ω—É—Ç
   - Refresh token: 7 –¥–Ω–µ–π
   - –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –∑–∞ 2 –º–∏–Ω—É—Ç—ã –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è

## üîç –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –æ—à–∏–±–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω:**
   ```javascript
   console.log(useAuthStore.getState().accessToken);
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î:**
   ```bash
   node test-friends-system.js
   ```

3. **–û—á–∏—Å—Ç–∏—Ç–µ localStorage:**
   ```javascript
   localStorage.clear();
   window.location.reload();
   ```

4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ:**
   ```bash
   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –∏ –∫–ª–∏–µ–Ω—Ç (Ctrl+C)
   node cleanup-db.js
   npm run dev  # –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
   ```

## ‚úÖ –ò—Ç–æ–≥–æ

–í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.
